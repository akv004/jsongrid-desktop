{"version":3,"file":"main.js","sources":["../../electron/main/main.ts"],"sourcesContent":["// electron/main/main.ts\nimport { app, BrowserWindow, ipcMain, dialog } from 'electron'\nimport { join, dirname } from 'node:path'\nimport { fileURLToPath } from 'node:url'\nimport { readFile, writeFile } from 'node:fs/promises'\n\nconst __filename = fileURLToPath(import.meta.url)\nconst __dirname = dirname(__filename)\n\nprocess.env.APP_ROOT = join(__dirname, '../..')\n\nexport const VITE_DEV_SERVER_URL = process.env['VITE_DEV_SERVER_URL']\nexport const MAIN_DIST = join(process.env.APP_ROOT, 'dist-electron')\nexport const RENDERER_DIST = join(process.env.APP_ROOT, 'dist')\n\nprocess.env.VITE_PUBLIC = VITE_DEV_SERVER_URL ? join(process.env.APP_ROOT, 'public') : RENDERER_DIST\n\nlet win: BrowserWindow | null\n\nfunction createWindow() {\n  win = new BrowserWindow({\n    // FIX: Set a default title for the window.\n    title: 'JSONGrid',\n    icon: join(process.env.VITE_PUBLIC, 'electron-vite.svg'),\n    webPreferences: {\n      preload: join(MAIN_DIST, 'preload.cjs'),\n    },\n  })\n\n  win.webContents.on('did-finish-load', () => {\n    win?.webContents.send('main-process-message', new Date().toLocaleString())\n  })\n\n  if (VITE_DEV_SERVER_URL) {\n    win.loadURL(VITE_DEV_SERVER_URL)\n    // FIX: Open DevTools automatically in development mode.\n    win.webContents.openDevTools()\n  } else {\n    win.loadFile(join(RENDERER_DIST, 'index.html'))\n  }\n}\n\napp.on('window-all-closed', () => {\n  if (process.platform !== 'darwin') {\n    app.quit()\n    win = null\n  }\n})\n\napp.on('activate', () => {\n  if (BrowserWindow.getAllWindows().length === 0) {\n    createWindow()\n  }\n})\n\napp.whenReady().then(createWindow)\n\nipcMain.handle('file:save', async (event, data: { filePath?: string; text: string }) => {\n  if (!win) return\n\n  const defaultPath = data.filePath || 'untitled.json'\n  const result = await dialog.showSaveDialog(win, {\n    defaultPath,\n    title: 'Save JSON File',\n    filters: [{ name: 'JSON Files', extensions: ['json'] }, { name: 'All Files', extensions: ['*'] }],\n  })\n\n  if (result.filePath) {\n    await writeFile(result.filePath, data.text, 'utf-8')\n    return { filePath: result.filePath }\n  }\n  return null\n})\n\nipcMain.handle('file:open', async () => {\n  if (!win) return\n\n  const result = await dialog.showOpenDialog(win, {\n    title: 'Open JSON File',\n    properties: ['openFile'],\n    filters: [{ name: 'JSON Files', extensions: ['json'] }, { name: 'All Files', extensions: ['*'] }],\n  })\n\n  if (result.filePaths && result.filePaths.length > 0) {\n    const filePath = result.filePaths[0]\n    const content = await readFile(filePath, 'utf-8')\n    return {\n      filePath: filePath,\n      text: content,\n    }\n  }\n  return null\n})\n\n/**\n * FIX: IPC handler to set the main window's title.\n * This allows the renderer process to update the title bar based on the current file.\n * It shows the filename for clarity.\n */\nipcMain.on('window:set-title', (event, filePath: string | undefined) => {\n  if (win) {\n    const baseTitle = 'JSONGrid'\n    const fileName = filePath ? filePath.split(/[/\\\\]/).pop() : undefined\n    win.setTitle(fileName ? `${fileName} â€” ${baseTitle}` : baseTitle)\n  }\n})"],"names":[],"mappings":";;;;AAMA,MAAM,aAAa,cAAc,YAAY,GAAG;AAChD,MAAM,YAAY,QAAQ,UAAU;AAEpC,QAAA,IAAY,WAAW,KAAK,WAAW,OAAO;AAEvC,MAAM,sBAAsB,YAAY,qBAAqB;AAC7D,MAAM,YAAY,KAAK,QAAA,IAAY,UAAU,eAAe;AAC5D,MAAM,gBAAgB,KAAK,QAAA,IAAY,UAAU,MAAM;AAE9D,QAAA,IAAY,cAAc,sBAAsB,KAAK,QAAA,IAAY,UAAU,QAAQ,IAAI;AAEvF,IAAI;AAEJ,SAAS,eAAe;AACtB,QAAM,IAAI,cAAc;AAAA;AAAA,IAEtB,OAAO;AAAA,IACP,MAAM,KAAK,QAAA,IAAY,aAAa,mBAAmB;AAAA,IACvD,gBAAgB;AAAA,MACd,SAAS,KAAK,WAAW,aAAa;AAAA,IAAA;AAAA,EACxC,CACD;AAED,MAAI,YAAY,GAAG,mBAAmB,MAAM;AAC1C,+BAAK,YAAY,KAAK,6CAA4B,KAAA,GAAO;EAC3D,CAAC;AAED,MAAI,qBAAqB;AACvB,QAAI,QAAQ,mBAAmB;AAE/B,QAAI,YAAY,aAAA;AAAA,EAClB,OAAO;AACL,QAAI,SAAS,KAAK,eAAe,YAAY,CAAC;AAAA,EAChD;AACF;AAEA,IAAI,GAAG,qBAAqB,MAAM;AAChC,MAAI,QAAQ,aAAa,UAAU;AACjC,QAAI,KAAA;AACJ,UAAM;AAAA,EACR;AACF,CAAC;AAED,IAAI,GAAG,YAAY,MAAM;AACvB,MAAI,cAAc,gBAAgB,WAAW,GAAG;AAC9C,iBAAA;AAAA,EACF;AACF,CAAC;AAED,IAAI,UAAA,EAAY,KAAK,YAAY;AAEjC,QAAQ,OAAO,aAAa,OAAO,OAAO,SAA8C;AACtF,MAAI,CAAC,IAAK;AAEV,QAAM,cAAc,KAAK,YAAY;AACrC,QAAM,SAAS,MAAM,OAAO,eAAe,KAAK;AAAA,IAC9C;AAAA,IACA,OAAO;AAAA,IACP,SAAS,CAAC,EAAE,MAAM,cAAc,YAAY,CAAC,MAAM,EAAA,GAAK,EAAE,MAAM,aAAa,YAAY,CAAC,GAAG,GAAG;AAAA,EAAA,CACjG;AAED,MAAI,OAAO,UAAU;AACnB,UAAM,UAAU,OAAO,UAAU,KAAK,MAAM,OAAO;AACnD,WAAO,EAAE,UAAU,OAAO,SAAA;AAAA,EAC5B;AACA,SAAO;AACT,CAAC;AAED,QAAQ,OAAO,aAAa,YAAY;AACtC,MAAI,CAAC,IAAK;AAEV,QAAM,SAAS,MAAM,OAAO,eAAe,KAAK;AAAA,IAC9C,OAAO;AAAA,IACP,YAAY,CAAC,UAAU;AAAA,IACvB,SAAS,CAAC,EAAE,MAAM,cAAc,YAAY,CAAC,MAAM,EAAA,GAAK,EAAE,MAAM,aAAa,YAAY,CAAC,GAAG,GAAG;AAAA,EAAA,CACjG;AAED,MAAI,OAAO,aAAa,OAAO,UAAU,SAAS,GAAG;AACnD,UAAM,WAAW,OAAO,UAAU,CAAC;AACnC,UAAM,UAAU,MAAM,SAAS,UAAU,OAAO;AAChD,WAAO;AAAA,MACL;AAAA,MACA,MAAM;AAAA,IAAA;AAAA,EAEV;AACA,SAAO;AACT,CAAC;AAOD,QAAQ,GAAG,oBAAoB,CAAC,OAAO,aAAiC;AACtE,MAAI,KAAK;AACP,UAAM,YAAY;AAClB,UAAM,WAAW,WAAW,SAAS,MAAM,OAAO,EAAE,QAAQ;AAC5D,QAAI,SAAS,WAAW,GAAG,QAAQ,MAAM,SAAS,KAAK,SAAS;AAAA,EAClE;AACF,CAAC;"}