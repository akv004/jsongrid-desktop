{"version":3,"file":"main.js","sources":["../../electron/main/main.ts"],"sourcesContent":["// electron/main/main.ts\nimport { app, BrowserWindow, ipcMain, dialog } from 'electron'\nimport { join, dirname } from 'node:path'\nimport { fileURLToPath } from 'node:url'\nimport { readFile, writeFile } from 'node:fs/promises'\n\nconst __filename = fileURLToPath(import.meta.url)\nconst __dirname = dirname(__filename)\n\nprocess.env.APP_ROOT = join(__dirname, '../..')\n\nexport const VITE_DEV_SERVER_URL = process.env['VITE_DEV_SERVER_URL']\nexport const MAIN_DIST = join(process.env.APP_ROOT, 'dist-electron')\nexport const RENDERER_DIST = join(process.env.APP_ROOT, 'dist')\n\nprocess.env.VITE_PUBLIC = VITE_DEV_SERVER_URL ? join(process.env.APP_ROOT, 'public') : RENDERER_DIST\n\nlet win: BrowserWindow | null\n\nfunction createWindow() {\n  win = new BrowserWindow({\n    // FIX: Set a default title for the window.\n    title: 'JSONGrid',\n    icon: join(process.env.VITE_PUBLIC, 'electron-vite.svg'),\n    webPreferences: {\n      preload: join(MAIN_DIST, 'preload.cjs'),\n    },\n  })\n\n  win.webContents.on('did-finish-load', () => {\n    win?.webContents.send('main-process-message', new Date().toLocaleString())\n  })\n\n  if (VITE_DEV_SERVER_URL) {\n    win.loadURL(VITE_DEV_SERVER_URL)\n    // FIX: Open DevTools automatically in development mode.\n    win.webContents.openDevTools()\n  } else {\n    win.loadFile(join(RENDERER_DIST, 'index.html'))\n  }\n}\n\napp.on('window-all-closed', () => {\n  if (process.platform !== 'darwin') {\n    app.quit()\n    win = null\n  }\n})\n\napp.on('activate', () => {\n  if (BrowserWindow.getAllWindows().length === 0) {\n    createWindow()\n  }\n})\n\napp.whenReady().then(createWindow)\n\nipcMain.handle('file:save', async (event, data: { filePath?: string; text: string }) => {\n  if (!win) return\n\n  const defaultPath = data.filePath || 'untitled.json'\n  const result = await dialog.showSaveDialog(win, {\n    defaultPath,\n    title: 'Save JSON File',\n    filters: [{ name: 'JSON Files', extensions: ['json'] }, { name: 'All Files', extensions: ['*'] }],\n  })\n\n  if (result.filePath) {\n    await writeFile(result.filePath, data.text, 'utf-8')\n    return { filePath: result.filePath }\n  }\n  return null\n})\n\nipcMain.handle('file:open', async () => {\n  if (!win) return\n\n  const result = await dialog.showOpenDialog(win, {\n    title: 'Open JSON File',\n    properties: ['openFile'],\n    filters: [{ name: 'JSON Files', extensions: ['json'] }, { name: 'All Files', extensions: ['*'] }],\n  })\n\n  if (result.filePaths && result.filePaths.length > 0) {\n    const filePath = result.filePaths[0]\n    const content = await readFile(filePath, 'utf-8')\n    return {\n      filePath: filePath,\n      text: content,\n    }\n  }\n  return null\n})\n\n/**\n * FIX: IPC handler to set the main window's title.\n * This allows the renderer process to update the title bar based on the current file.\n * It shows the filename for clarity.\n */\nipcMain.on('window:set-title', (event, filePath: string | undefined) => {\n  if (win) {\n    const baseTitle = 'JSONGrid'\n    const fileName = filePath ? filePath.split(/[/\\\\]/).pop() : undefined\n    win.setTitle(fileName ? `${fileName} â€” ${baseTitle}` : baseTitle)\n  }\n})"],"names":["__filename","fileURLToPath","__dirname","dirname","join","VITE_DEV_SERVER_URL","MAIN_DIST","RENDERER_DIST","win","createWindow","BrowserWindow","app","ipcMain","event","data","defaultPath","result","dialog","writeFile","filePath","content","readFile","baseTitle","fileName"],"mappings":";;;;AAMA,MAAMA,IAAaC,EAAc,YAAY,GAAG,GAC1CC,IAAYC,EAAQH,CAAU;AAEpC,QAAA,IAAY,WAAWI,EAAKF,GAAW,OAAO;AAEvC,MAAMG,IAAsB,YAAY,qBAClCC,IAAYF,EAAK,QAAA,IAAY,UAAU,eAAe,GACtDG,IAAgBH,EAAK,QAAA,IAAY,UAAU,MAAM;AAE9D,QAAA,IAAY,cAAcC,IAAsBD,EAAK,QAAA,IAAY,UAAU,QAAQ,IAAIG;AAEvF,IAAIC;AAEJ,SAASC,IAAe;AACtB,EAAAD,IAAM,IAAIE,EAAc;AAAA;AAAA,IAEtB,OAAO;AAAA,IACP,MAAMN,EAAK,QAAA,IAAY,aAAa,mBAAmB;AAAA,IACvD,gBAAgB;AAAA,MACd,SAASA,EAAKE,GAAW,aAAa;AAAA,IAAA;AAAA,EACxC,CACD,GAEDE,EAAI,YAAY,GAAG,mBAAmB,MAAM;AAC1C,IAAAA,KAAA,QAAAA,EAAK,YAAY,KAAK,6CAA4B,KAAA,GAAO;EAC3D,CAAC,GAEGH,KACFG,EAAI,QAAQH,CAAmB,GAE/BG,EAAI,YAAY,aAAA,KAEhBA,EAAI,SAASJ,EAAKG,GAAe,YAAY,CAAC;AAElD;AAEAI,EAAI,GAAG,qBAAqB,MAAM;AAChC,EAAI,QAAQ,aAAa,aACvBA,EAAI,KAAA,GACJH,IAAM;AAEV,CAAC;AAEDG,EAAI,GAAG,YAAY,MAAM;AACvB,EAAID,EAAc,gBAAgB,WAAW,KAC3CD,EAAA;AAEJ,CAAC;AAEDE,EAAI,UAAA,EAAY,KAAKF,CAAY;AAEjCG,EAAQ,OAAO,aAAa,OAAOC,GAAOC,MAA8C;AACtF,MAAI,CAACN,EAAK;AAEV,QAAMO,IAAcD,EAAK,YAAY,iBAC/BE,IAAS,MAAMC,EAAO,eAAeT,GAAK;AAAA,IAC9C,aAAAO;AAAA,IACA,OAAO;AAAA,IACP,SAAS,CAAC,EAAE,MAAM,cAAc,YAAY,CAAC,MAAM,EAAA,GAAK,EAAE,MAAM,aAAa,YAAY,CAAC,GAAG,GAAG;AAAA,EAAA,CACjG;AAED,SAAIC,EAAO,YACT,MAAME,EAAUF,EAAO,UAAUF,EAAK,MAAM,OAAO,GAC5C,EAAE,UAAUE,EAAO,SAAA,KAErB;AACT,CAAC;AAEDJ,EAAQ,OAAO,aAAa,YAAY;AACtC,MAAI,CAACJ,EAAK;AAEV,QAAMQ,IAAS,MAAMC,EAAO,eAAeT,GAAK;AAAA,IAC9C,OAAO;AAAA,IACP,YAAY,CAAC,UAAU;AAAA,IACvB,SAAS,CAAC,EAAE,MAAM,cAAc,YAAY,CAAC,MAAM,EAAA,GAAK,EAAE,MAAM,aAAa,YAAY,CAAC,GAAG,GAAG;AAAA,EAAA,CACjG;AAED,MAAIQ,EAAO,aAAaA,EAAO,UAAU,SAAS,GAAG;AACnD,UAAMG,IAAWH,EAAO,UAAU,CAAC,GAC7BI,IAAU,MAAMC,EAASF,GAAU,OAAO;AAChD,WAAO;AAAA,MACL,UAAAA;AAAA,MACA,MAAMC;AAAA,IAAA;AAAA,EAEV;AACA,SAAO;AACT,CAAC;AAODR,EAAQ,GAAG,oBAAoB,CAACC,GAAOM,MAAiC;AACtE,MAAIX,GAAK;AACP,UAAMc,IAAY,YACZC,IAAWJ,IAAWA,EAAS,MAAM,OAAO,EAAE,QAAQ;AAC5D,IAAAX,EAAI,SAASe,IAAW,GAAGA,CAAQ,MAAMD,CAAS,KAAKA,CAAS;AAAA,EAClE;AACF,CAAC;"}